{
	"info": {
		"_postman_id": "atom-ocr-ai-2025",
		"name": "Atom OCR AI - API Collection 2025 (Renovada)",
		"description": "ColecciÃ³n completa renovada para la API de Atom OCR AI con todos los endpoints disponibles, debugging avanzado y manejo robusto de tokens JWT",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "atom-ocr-ai",
		"version": {
			"major": 2,
			"minor": 0,
			"patch": 0
		}
	},
	"item": [
		{
			"name": "ðŸ” AutenticaciÃ³n",
			"description": "Endpoints para autenticaciÃ³n y gestiÃ³n de tokens JWT",
			"item": [
				{
					"name": "Login",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ðŸš€ === INICIANDO LOGIN === ðŸš€');",
									"console.log('Timestamp:', new Date().toISOString());",
									"console.log('Limpiando tokens anteriores...');",
									"pm.environment.unset('access_token');",
									"pm.environment.unset('refresh_token');",
									"pm.environment.unset('token_expires_at');",
									"console.log('âœ… Tokens anteriores limpiados.');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA LOGIN === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"console.log('Response Time:', pm.response.responseTime + 'ms');",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('ðŸŽ‰ LOGIN EXITOSO ðŸŽ‰');",
									"    let response = pm.response.json();",
									"    pm.environment.set('access_token', response.access_token);",
									"    pm.environment.set('refresh_token', response.refresh_token);",
									"    const expiresAt = new Date(Date.now() + (response.expires_in * 1000));",
									"    pm.environment.set('token_expires_at', expiresAt.toISOString());",
									"    console.log('âœ… Tokens guardados correctamente');",
									"    pm.test('âœ… Login successful', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ LOGIN FALLÃ“ - Status:', pm.response.code);",
									"    pm.test('âŒ Login failed', () => pm.expect.fail('Login failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"{{username}}\",\n    \"password\": \"{{password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/login",
							"host": ["{{base_url}}"],
							"path": ["login"]
						}
					},
					"response": []
				},
				{
					"name": "User Info",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ðŸ‘¤ === PRE-REQUEST USER INFO === ðŸ‘¤');",
									"const token = pm.environment.get('access_token');",
									"console.log('ðŸ”§ Access Token disponible:', token ? 'SÃ' : 'NO');",
									"if (!token) console.log('ðŸš¨ WARNING: No access token found!');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA USER INFO === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('ðŸŽ‰ USER INFO OBTENIDA EXITOSAMENTE ðŸŽ‰');",
									"    let response = pm.response.json();",
									"    pm.environment.set('current_user_id', response.id);",
									"    pm.environment.set('current_user_role', response.role);",
									"    console.log('ðŸ‘¤ Usuario:', response.username, '- Rol:', response.role);",
									"    pm.test('âœ… User info retrieved', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ ERROR - Status:', pm.response.code);",
									"    if (pm.response.code === 401) console.log('ðŸ’¡ SUGERENCIA: Ejecuta Login primero');",
									"    pm.test('âŒ User info failed', () => pm.expect.fail('Request failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/userinfo",
							"host": ["{{base_url}}"],
							"path": ["userinfo"]
						}
					},
					"response": []
				},
				{
					"name": "Refresh Token",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ðŸ”„ === PRE-REQUEST REFRESH TOKEN === ðŸ”„');",
									"const refreshToken = pm.environment.get('refresh_token');",
									"console.log('ðŸ”§ Refresh Token disponible:', refreshToken ? 'SÃ' : 'NO');",
									"if (!refreshToken) console.log('ðŸš¨ WARNING: No refresh token found!');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA REFRESH TOKEN === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('ðŸŽ‰ TOKEN REFRESH EXITOSO ðŸŽ‰');",
									"    let response = pm.response.json();",
									"    pm.environment.set('access_token', response.access_token);",
									"    const expiresAt = new Date(Date.now() + (response.expires_in * 1000));",
									"    pm.environment.set('token_expires_at', expiresAt.toISOString());",
									"    console.log('âœ… Nuevo token guardado');",
									"    pm.test('âœ… Token refresh successful', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ TOKEN REFRESH FALLÃ“ - Status:', pm.response.code);",
									"    pm.test('âŒ Token refresh failed', () => pm.expect.fail('Refresh failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"refresh_token\": \"{{refresh_token}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/refresh",
							"host": ["{{base_url}}"],
							"path": ["refresh"]
						}
					},
					"response": []
				},
				{
					"name": "Register User (Admin Only)",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"console.log('ðŸ‘¥ === PRE-REQUEST REGISTER USER === ðŸ‘¥');",
									"const token = pm.environment.get('access_token');",
									"const userRole = pm.environment.get('current_user_role');",
									"console.log('ðŸ”§ Token disponible:', token ? 'SÃ' : 'NO');",
									"console.log('ðŸ”§ Rol actual:', userRole || 'NO DETERMINADO');",
									"if (userRole !== 'admin') console.log('âš ï¸ WARNING: Se requieren privilegios de admin');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA REGISTER USER === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 201) {",
									"    console.log('ðŸŽ‰ USUARIO REGISTRADO EXITOSAMENTE ðŸŽ‰');",
									"    let response = pm.response.json();",
									"    console.log('ðŸ‘¤ Usuario creado:', response.username);",
									"    pm.test('âœ… User registered successfully', () => pm.response.to.have.status(201));",
									"} else {",
									"    console.log('âŒ REGISTRO FALLÃ“ - Status:', pm.response.code);",
									"    if (pm.response.code === 403) console.log('ðŸš« Acceso denegado - Se requieren privilegios de admin');",
									"    pm.test('âŒ Registration failed', () => pm.expect.fail('Registration failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"username\": \"nuevo_usuario\",\n    \"email\": \"nuevo@ejemplo.com\",\n    \"password\": \"password123\",\n    \"role\": \"user\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/register",
							"host": ["{{base_url}}"],
							"path": ["register"]
						}
					},
					"response": []
				},
				{
					"name": "Logout",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA LOGOUT === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('ðŸŽ‰ LOGOUT EXITOSO ðŸŽ‰');",
									"    console.log('ðŸ§¹ Limpiando tokens del entorno...');",
									"    pm.environment.unset('access_token');",
									"    pm.environment.unset('refresh_token');",
									"    pm.environment.unset('token_expires_at');",
									"    pm.environment.unset('current_user_id');",
									"    pm.environment.unset('current_user_role');",
									"    console.log('âœ… Tokens limpiados correctamente');",
									"    pm.test('âœ… Logout successful', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ LOGOUT FALLÃ“ - Status:', pm.response.code);",
									"    pm.test('âŒ Logout failed', () => pm.expect.fail('Logout failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/logout",
							"host": ["{{base_url}}"],
							"path": ["logout"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "ðŸ‘¥ GestiÃ³n de Clientes",
			"description": "Endpoints para gestionar clientes y aplicaciones",
			"item": [
				{
					"name": "Create Client",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA CREATE CLIENT === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 201) {",
									"    console.log('ðŸŽ‰ CLIENTE CREADO EXITOSAMENTE ðŸŽ‰');",
									"    let response = pm.response.json();",
									"    if (response.id) {",
									"        pm.environment.set('last_created_client_id', response.id);",
									"        console.log('ðŸ’¾ Client ID guardado:', response.id);",
									"    }",
									"    pm.test('âœ… Client created successfully', () => pm.response.to.have.status(201));",
									"} else {",
									"    console.log('âŒ CREACIÃ“N DE CLIENTE FALLÃ“ - Status:', pm.response.code);",
									"    pm.test('âŒ Client creation failed', () => pm.expect.fail('Client creation failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Mi AplicaciÃ³n OCR\",\n    \"description\": \"AplicaciÃ³n para procesamiento de documentos\",\n    \"redirect_uris\": [\"http://localhost:3000/callback\"],\n    \"allowed_origins\": [\"http://localhost:3000\"]\n}"
						},
						"url": {
							"raw": "{{base_url}}/clients",
							"host": ["{{base_url}}"],
							"path": ["clients"]
						}
					},
					"response": []
				},
				{
					"name": "List Clients",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“Š === RESPUESTA LIST CLIENTS === ðŸ“Š');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('âœ… LISTA DE CLIENTES OBTENIDA');",
									"    let response = pm.response.json();",
									"    console.log('ðŸ“‹ Total de clientes:', response.length || 0);",
									"    pm.test('âœ… Clients list retrieved', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ ERROR AL OBTENER CLIENTES - Status:', pm.response.code);",
									"    pm.test('âŒ Clients list failed', () => pm.expect.fail('Failed to get clients'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{access_token}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/clients",
							"host": ["{{base_url}}"],
							"path": ["clients"]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "ðŸ”§ Sistema",
			"description": "Endpoints para informaciÃ³n del sistema y salud",
			"item": [
				{
					"name": "Health Check",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ¥ === RESPUESTA HEALTH CHECK === ðŸ¥');",
									"console.log('Status Code:', pm.response.code);",
									"console.log('Response Time:', pm.response.responseTime + 'ms');",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('âœ… SISTEMA SALUDABLE');",
									"    try {",
									"        let response = pm.response.json();",
									"        console.log('ðŸ¥ Estado del sistema:', JSON.stringify(response, null, 2));",
									"    } catch (e) {",
									"        console.log('Response text:', pm.response.text());",
									"    }",
									"    pm.test('âœ… System is healthy', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('ðŸš¨ SISTEMA CON PROBLEMAS - Status:', pm.response.code);",
									"    pm.test('âŒ System health check failed', () => pm.expect.fail('Health check failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/system/health",
							"host": ["{{base_url}}"],
							"path": ["system", "health"]
						}
					},
					"response": []
				},
				{
					"name": "System Version",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"console.log('ðŸ“‹ === RESPUESTA SYSTEM VERSION === ðŸ“‹');",
									"console.log('Status Code:', pm.response.code);",
									"",
									"if (pm.response.code === 200) {",
									"    console.log('âœ… VERSIÃ“N DEL SISTEMA OBTENIDA');",
									"    try {",
									"        let response = pm.response.json();",
									"        console.log('ðŸ“‹ VersiÃ³n:', response.version || 'No disponible');",
									"        console.log('ðŸ“‹ Build:', response.build || 'No disponible');",
									"    } catch (e) {",
									"        console.log('Response text:', pm.response.text());",
									"    }",
									"    pm.test('âœ… System version retrieved', () => pm.response.to.have.status(200));",
									"} else {",
									"    console.log('âŒ ERROR AL OBTENER VERSIÃ“N - Status:', pm.response.code);",
									"    pm.test('âŒ System version failed', () => pm.expect.fail('Version check failed'));",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/system/version",
							"host": ["{{base_url}}"],
							"path": ["system", "version"]
						}
					},
					"response": []
				}
			]
		}
	]
}